# IFRS 15 Contract Management System

## Overview

This is an enterprise financial compliance application for managing contracts and revenue recognition under IFRS 15 accounting standards. The system provides contract lifecycle management, IFRS 15 five-step revenue recognition engine, license management with IP-based access control, Stripe billing integration, and comprehensive audit trails for finance teams and auditors.

## Recent Changes

### December 2024
- **Complete Frontend Implementation**: Built all pages (Dashboard, Contracts, Customers, Licenses, Reports, IFRS 15 Engine, Audit Trail, Settings)
- **Backend API Routes**: Implemented full CRUD operations for all entities
- **Stripe Integration**: Added billing webhooks and checkout session creation
- **IP-Based License Management**: Implemented license validation, heartbeat, and session tracking
- **IFRS 15 Reports**: Added disaggregated revenue, contract balances, and remaining obligations reports
- **Audit Trail**: Complete audit logging for all entity changes
- **Authentication System**: Complete session-based auth with bcrypt password hashing, login/logout, password change, and license activation flows
- **Admin User**: Seeded admin account (fernandocostaxavier@gmail.com) with role-based access control
- **Protected Routes**: Authentication flow with redirect to login, mandatory password change for new users, license activation before dashboard access

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Routing**: Wouter (lightweight client-side routing)
- **State Management**: TanStack React Query for server state caching and synchronization
- **UI Components**: shadcn/ui component library built on Radix UI primitives
- **Styling**: Tailwind CSS with CSS variables for theming (light/dark mode support)
- **Charts**: Recharts for data visualization on dashboards and reports
- **Build Tool**: Vite with React plugin

### Backend Architecture
- **Runtime**: Node.js with Express.js
- **Language**: TypeScript (ESM modules)
- **API Design**: RESTful endpoints under `/api/*` prefix
- **Database ORM**: Drizzle ORM with PostgreSQL dialect
- **Schema Validation**: Zod with drizzle-zod for type-safe schema validation
- **Session Management**: express-session with connect-pg-simple for PostgreSQL session storage

### Data Storage
- **Primary Database**: PostgreSQL
- **Schema Location**: `shared/schema.ts` contains all table definitions
- **Key Tables**: 
  - `tenants` - Multi-tenant organization support
  - `users` - RBAC with roles (admin, finance, auditor, operations, readonly)
  - `customers` - Customer records per tenant
  - `contracts` and `contractVersions` - Contract lifecycle with versioning
  - `contractLineItems` - Individual contract items
  - `performanceObligations` - IFRS 15 performance obligations
  - `revenueSchedules` - Revenue recognition schedules
  - `variableConsiderations` - Variable pricing tracking
  - `contractBalances` - Contract assets and liabilities
  - `licenses` and `licenseSessions` - IP-based license management
  - `auditLogs` - Comprehensive audit trail
  - `stripeEvents` - Stripe webhook event storage

### Authentication and Authorization
- Session-based authentication with HTTP-only cookies
- Password security: bcrypt hashing with salt rounds of 10
- Role-based access control (RBAC) with enumerated user roles (admin, finance, auditor, operations, readonly)
- Tenant isolation for multi-organization support
- Authentication flow: Login → Change Password (if required) → Activate License → Dashboard
- Admin sidebar sections visible only to admin role users
- Default admin: fernandocostaxavier@gmail.com (seeded on startup)

### External Service Integrations
- **Stripe**: Payment processing and subscription billing via Stripe Billing API
- **License Validation**: IP-based session locking (one active IP per license)

### Project Structure
```
├── client/           # React frontend application
│   └── src/
│       ├── components/   # Reusable UI components
│       ├── pages/        # Route page components
│       ├── hooks/        # Custom React hooks
│       └── lib/          # Utilities and API client
├── server/           # Express backend
│   ├── routes.ts     # API route definitions
│   ├── storage.ts    # Database operations
│   └── db.ts         # Database connection
├── shared/           # Shared code between client/server
│   └── schema.ts     # Drizzle database schema
└── migrations/       # Database migrations (generated by drizzle-kit)
```

### Development Commands
- `npm run dev` - Start development server with hot reload
- `npm run build` - Build for production
- `npm run db:push` - Push schema changes to database
- `npm run check` - TypeScript type checking

## External Dependencies

### Payment Processing
- **Stripe**: Handles subscription billing, customer management, and payment processing. Requires `STRIPE_SECRET_KEY` environment variable. Uses Stripe Billing for recurring revenue with webhook support for event handling.

### Database
- **PostgreSQL**: Primary data store. Requires `DATABASE_URL` environment variable. Used for all application data including sessions, audit logs, and business entities.

### Third-Party UI Libraries
- **Radix UI**: Headless component primitives for accessibility
- **Recharts**: React charting library for financial dashboards
- **date-fns**: Date manipulation utilities
- **cmdk**: Command palette component

### Build and Development
- **Vite**: Frontend build tool with HMR
- **esbuild**: Server bundling for production
- **drizzle-kit**: Database migration tooling